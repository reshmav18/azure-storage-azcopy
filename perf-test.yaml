trigger: none
pr: none

stages:
- stage: Smallfiles
  jobs:
    - job: PerformanceTest
      timeoutInMinutes: 360
      strategy:
        matrix:
          Ubuntu-22:
            imageName: "azcopyPerfUbuntu22"
            Description: "AzCopy Perf Test"

      pool:
        name: "AzCopyPerfTestUbuntu"
        demands:
          - ImageOverride -equals $(imageName)

      variables:
        - name: "AZCOPY_AUTO_LOGIN_TYPE"
          value: $(AZCOPY_AUTO_LOGIN_TYPE)
        - name: "AZCOPY_MSI_CLIENT_ID"
          value: $(AZCOPY_MSI_CLIENT_ID)
        - name: "AZCOPY_SHOW_PERF_STATES"
          value: "1"

      steps:
#        - checkout: none
#          path: "$(Agent.HomeDirectory)/go/src/github.com/Azure/azure-storage-azcopy/"

        - script: |
            echo $(Description)
            hostnamectl
          displayName: 'Print Agent Info'

        - task: GoTool@0
          inputs:
            version: '1.19.3'
        
        - script: |
            go build -o $GOROOT/bin/azcopy
            azcopy list https://storenakulkar.blob.core.windows.net/container11/
          displayName: 'Build Azcopy'

      